<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    body {background-color: #0a0a0a}
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #e4e5ea; -webkit-text-stroke: #e4e5ea; background-color: #0a0a0a}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; color: #e4e5ea; -webkit-text-stroke: #e4e5ea; background-color: #0a0a0a; min-height: 15.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="es"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;meta charset="UTF-8" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;title&gt;Mapa de la Isla - Visualizador Interactivo&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>:root {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>--bg: #0a0a0a;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>--panel: #111317;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>--border: #2a2d34;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>--text: #e9eaee;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>--muted: #9aa1aa;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>--accent: #6ab0ff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>--gap: 16px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>* { box-sizing: border-box; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>margin: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>font-family: -apple-system, system-ui, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>background: var(--bg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>color: var(--text);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>min-height: 100svh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>display: grid;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>grid-template-rows: auto 1fr auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>header {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 12px 16px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border-bottom: 1px solid var(--border);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>justify-content: space-between;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>gap: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(180deg, #0d0f13, #0a0a0a);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>header h1 {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 18px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>margin: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing: .3px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>color: var(--text);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.toolbar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>gap: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>flex-wrap: wrap;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>appearance: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid var(--border);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>background: #171a20;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>color: var(--text);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 8px 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 10px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight: 600;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>cursor: pointer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>transition: transform .05s ease, background .2s ease, border-color .2s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.btn:hover { background: #1d222b; border-color: #3a3f48; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.btn:active { transform: translateY(1px) scale(.98); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.palette {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>display: inline-flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>gap: 6px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 6px 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>background: #12151a;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid var(--border);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.swatch {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>width: 22px; height: 22px; border-radius: 6px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid #00000055; cursor: pointer; outline: 2px solid transparent;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>transition: transform .05s ease, outline-color .2s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.swatch:active { transform: scale(.96); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.swatch.selected { outline: 2px solid #ffffffaa; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>main {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: clamp(10px, 3vw, 24px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>display: grid;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>grid-template-columns: 1fr min(34ch, 360px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>gap: var(--gap);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items: start;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>@media (max-width: 900px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>main { grid-template-columns: 1fr; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>#sidebar { order: 2; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>#stage <span class="Apple-converted-space">Â  </span>{ order: 1; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>/* Escenario del mapa */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#stage {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>background: #0e0f12;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid var(--border);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 14px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow: hidden; /* usamos zoom con transform, sin scrollbars aquÃ­ */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 10px 30px rgba(0,0,0,.45);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>max-width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>max-height: 78vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>min-height: 320px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.scaleLayer {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>transform-origin: top left;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>user-select: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>-webkit-user-drag: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.mapImage { display: block; width: 100%; height: auto; pointer-events: none; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>/* Marcadores */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.marker { position: absolute; left: 0; top: 0; transform: translate(-50%, -50%); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.marker-dot {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>width: 18px; height: 18px; border-radius: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 2px solid #fff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 2px 8px rgba(0,0,0,.6);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>transform-origin: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>transition: box-shadow .2s ease, border-color .2s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.marker.selected .marker-dot { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(106,176,255,.35); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>/* Tooltip opcional (hover) */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.tooltip { position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%); background: rgba(20,20,20,0.9); color: var(--text); padding: 6px 10px; border-radius: 6px; white-space: nowrap; font-size: 13px; pointer-events: none; opacity: 0; transition: opacity .2s ease; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.marker:hover .tooltip { opacity: 1; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>/* Sidebar de comentarios */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#sidebar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>background: var(--panel);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid var(--border);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 14px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>max-height: 78vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow: auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>-webkit-overflow-scrolling: touch;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>#sidebar h2 { font-size: 16px; margin: 0 0 8px; color: var(--text); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.muted { color: var(--muted); font-size: 13px; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.list { display: grid; gap: 6px; margin: 10px 0 12px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.item {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>display: grid; grid-template-columns: 22px 1fr auto; align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>gap: 8px; padding: 6px 8px; border: 1px solid var(--border); border-radius: 10px; background: #141820; cursor: pointer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.item:hover { background: #171c25; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.item .dot { width: 16px; height: 16px; border-radius: 50%; border: 2px solid #fff; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.item .coords { font-size: 12px; color: var(--muted); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.item .id { font-size: 12px; opacity: .6; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.item.selected { outline: 2px solid rgba(106,176,255,.4); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>form { display: grid; gap: 8px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>label { font-size: 12px; color: var(--muted); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>textarea { width: 100%; min-height: 90px; resize: vertical; padding: 8px; border-radius: 10px; border: 1px solid var(--border); background: #0e1116; color: var(--text); font-family: inherit; font-size: 14px; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>.row { display: flex; gap: 8px; justify-content: flex-end; }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>footer { color: var(--muted); font-size: 12px; padding: 12px 16px; border-top: 1px solid var(--border); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;header&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;h1&gt;ğŸ—ºï¸ Mapa de la Isla â€“ Visualizador Interactivo&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="toolbar"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button id="zoomOut" class="btn" title="Alejar"&gt;âˆ’&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;span id="zoomLabel" aria-live="polite" style="min-width:64px;text-align:center;opacity:.85"&gt;100%&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button id="zoomIn" class="btn" title="Acercar"&gt;ï¼‹&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button id="zoomReset" class="btn" title="Restablecer zoom"&gt;Reset&lt;/button&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="palette" id="palette" aria-label="Selector de color"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/header&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;main&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- Escena del mapa --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="stage" role="application" aria-label="Mapa interactivo"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="scaleLayer" id="scaleLayer"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;img src="https://i.postimg.cc/Y0bwB3xB/temp-Imagea-Yb1ce.avif" alt="Mapa de la isla" id="mapImage" class="mapImage" /&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- Sidebar de comentarios / administraciÃ³n de marcadores --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;aside id="sidebar"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;Marcadores&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;p class="muted"&gt;Toca el mapa para crear uno nuevo. SelecciÃ³nalo para editar su comentario.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div id="markerList" class="list" aria-live="polite"&gt;&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;form id="commentForm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label for="commentInput"&gt;Comentario del marcador seleccionado&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;textarea id="commentInput" placeholder="Escribe aquÃ­..."&gt;&lt;/textarea&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="row"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button type="button" id="deleteBtn" class="btn" title="Eliminar marcador"&gt;Eliminar&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button type="submit" class="btn" title="Guardar comentario"&gt;Guardar&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/form&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>&lt;/aside&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/main&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;footer&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>Click en el mapa para agregar marcador. Usa la paleta para elegir color. Zoom con ï¼‹ / âˆ’ / Reset.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/footer&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const stage = document.getElementById('stage');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const scaleLayer = document.getElementById('scaleLayer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const img = document.getElementById('mapImage');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const zoomInBtn = document.getElementById('zoomIn');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const zoomOutBtn = document.getElementById('zoomOut');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const zoomResetBtn = document.getElementById('zoomReset');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const zoomLabel = document.getElementById('zoomLabel');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const paletteEl = document.getElementById('palette');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const sidebar = document.getElementById('sidebar');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const mainEl = document.querySelector('main');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const markerList = document.getElementById('markerList');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const commentForm = document.getElementById('commentForm');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const commentInput = document.getElementById('commentInput');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const deleteBtn = document.getElementById('deleteBtn');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>let baseW = 0, baseH = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>let zoom = 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const ZOOM_MIN = 0.5, ZOOM_MAX = 3, ZOOM_STEP = 0.15;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>const markers = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>let markerIdSeq = 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>let currentColor = '#ff0000';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>let selectedId = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function lerp(a,b,t){ return a + (b-a)*t; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function rgb(r,g,b){ return `rgb(${r|0},${g|0},${b|0})`; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function gradientColors(steps){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const colors = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const start = {r:255,g:0,b:0};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const end <span class="Apple-converted-space">Â  </span>= {r:0,g:200,b:0};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>for(let i=0;i&lt;steps;i++){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const t = i/(steps-1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>colors.push(rgb( lerp(start.r,end.r,t), lerp(start.g,end.g,t), lerp(start.b,end.b,t) ));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>return colors;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function buildPalette(){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const colors = gradientColors(12);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>colors.forEach((c,idx)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const sw = document.createElement('button');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sw.className = 'swatch';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sw.style.background = c;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sw.title = `Color ${idx+1}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sw.addEventListener('click',()=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>currentColor = c;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>document.querySelectorAll('.swatch').forEach(el=&gt;el.classList.remove('selected'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>sw.classList.add('selected');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(idx===0) sw.classList.add('selected');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>paletteEl.appendChild(sw);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function updateZoomUI(){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>zoomLabel.textContent = Math.round(zoom*100) + '%';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>scaleLayer.style.transform = `scale(${zoom})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>document.querySelectorAll('.marker-dot').forEach(dot=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>dot.style.transform = `translateZ(0) scale(${1/zoom})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>clampStageToViewport();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function clampStageToViewport(){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const mainWidth = mainEl.clientWidth;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const sidebarWidth = sidebar ? sidebar.offsetWidth + parseFloat(getComputedStyle(mainEl).gap || 16) : 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const available = Math.max(240, mainWidth - sidebarWidth);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const maxW = Math.min(available, img.naturalWidth*zoom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const maxH = Math.min(window.innerHeight*0.78, img.naturalHeight*zoom);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>stage.style.width = maxW + 'px';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>stage.style.height = maxH + 'px';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function limit(val,min,max){ return Math.max(min, Math.min(max,val)); }</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>zoomInBtn.addEventListener('click', ()=&gt;{ zoom = limit(zoom+ZOOM_STEP, ZOOM_MIN, ZOOM_MAX); updateZoomUI(); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>zoomOutBtn.addEventListener('click',()=&gt;{ zoom = limit(zoom-ZOOM_STEP, ZOOM_MIN, ZOOM_MAX); updateZoomUI(); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>zoomResetBtn.addEventListener('click',()=&gt;{ zoom = 1; updateZoomUI(); });</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function createMarker(xBase, yBase, color, comment){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const id = markerIdSeq++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const m = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>m.className = 'marker';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>m.style.left = xBase + 'px';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>m.style.top<span class="Apple-converted-space">Â  </span>= yBase + 'px';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>m.dataset.id = String(id);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const dot = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>dot.className = 'marker-dot';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>dot.style.background = color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>dot.style.transform = `translateZ(0) scale(${1/zoom})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>m.appendChild(dot);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(comment &amp;&amp; comment.trim() !== ""){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tip = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tip.className = 'tooltip';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tip.textContent = comment;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>m.appendChild(tip);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>m.addEventListener('click', (ev)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ev.stopPropagation();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>selectMarker(id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>scaleLayer.appendChild(m);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>markers.push({ id, x:xBase, y:yBase, color, comment: (comment||'').trim() });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>renderMarkerList();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>selectMarker(id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function renderMarkerList(){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>markerList.innerHTML = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(markers.length === 0){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const p = document.createElement('p'); p.className = 'muted'; p.textContent = 'No hay marcadores todavÃ­a.'; markerList.appendChild(p); return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>markers.forEach(m=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const item = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>item.className = 'item' + (m.id===selectedId ? ' selected' : '');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>item.dataset.id = String(m.id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const dot = document.createElement('div'); dot.className = 'dot'; dot.style.background = m.color;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const info = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const title = document.createElement('div'); title.textContent = m.comment ? (m.comment.slice(0,40) + (m.comment.length&gt;40?'â€¦':'')) : 'Sin comentario';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const coords = document.createElement('div'); coords.className = 'coords'; coords.textContent = `x:${Math.round(m.x)} y:${Math.round(m.y)}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>info.appendChild(title); info.appendChild(coords);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const idEl = document.createElement('div'); idEl.className = 'id'; idEl.textContent = `#${m.id}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>item.appendChild(dot); item.appendChild(info); item.appendChild(idEl);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>item.addEventListener('click', ()=&gt; selectMarker(m.id));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>markerList.appendChild(item);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function selectMarker(id){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>selectedId = id;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>document.querySelectorAll('.marker').forEach(el=&gt; el.classList.remove('selected'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const markerEl = Array.from(document.querySelectorAll('.marker')).find(el =&gt; Number(el.dataset.id)===id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(markerEl){ markerEl.classList.add('selected'); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const rec = markers.find(m =&gt; m.id===id);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(rec){ commentInput.value = rec.comment || ''; }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>renderMarkerList();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>commentForm.addEventListener('submit', (e)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>e.preventDefault();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(selectedId==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const rec = markers.find(m =&gt; m.id===selectedId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(!rec) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>rec.comment = (commentInput.value||'').trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// actualizar tooltip (crear si no existe)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const el = Array.from(document.querySelectorAll('.marker')).find(el =&gt; Number(el.dataset.id)===selectedId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(el){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let tip = el.querySelector('.tooltip');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if(!tip){ tip = document.createElement('div'); tip.className = 'tooltip'; el.appendChild(tip); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tip.textContent = rec.comment || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>renderMarkerList();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>deleteBtn.addEventListener('click', ()=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(selectedId==null) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const idx = markers.findIndex(m =&gt; m.id===selectedId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(idx===-1) return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// eliminar del DOM</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const el = Array.from(document.querySelectorAll('.marker')).find(el =&gt; Number(el.dataset.id)===selectedId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(el &amp;&amp; el.parentNode){ el.parentNode.removeChild(el); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>markers.splice(idx,1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>selectedId = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>commentInput.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>renderMarkerList();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>stage.addEventListener('click', (e)=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// crear marcador en coordenadas base, sin prompt; usar panel para editar</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const rect = stage.getBoundingClientRect();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const xView = e.clientX - rect.left;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const yView = e.clientY - rect.top;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const xBase = xView / zoom;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>const yBase = yView / zoom;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>createMarker(xBase, yBase, currentColor, '');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>// foco al textarea para escribir de inmediato</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>setTimeout(()=&gt; commentInput.focus(), 0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function initZoomButtons(){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>function limit(val,min,max){ return Math.max(min, Math.min(max,val)); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>zoomInBtn.addEventListener('click', ()=&gt;{ zoom = limit(zoom+ZOOM_STEP, ZOOM_MIN, ZOOM_MAX); updateZoomUI(); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>zoomOutBtn.addEventListener('click',()=&gt;{ zoom = limit(zoom-ZOOM_STEP, ZOOM_MIN, ZOOM_MAX); updateZoomUI(); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>zoomResetBtn.addEventListener('click',()=&gt;{ zoom = 1; updateZoomUI(); });</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>function build(){</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>buildPalette();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>initZoomButtons();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>if(img.complete) { img.dispatchEvent(new Event('load')); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>img.addEventListener('load', ()=&gt;{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>baseW = img.naturalWidth; baseH = img.naturalHeight;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>scaleLayer.style.width = baseW + 'px';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>scaleLayer.style.height = baseH + 'px';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>clampStageToViewport();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  Â  </span>updateZoomUI();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener('resize', clampStageToViewport);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  Â  </span>build();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">Â  </span>&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
